import{s as Ae,J as G,f as ie,a as se,g as ne,h as oe,c as le,d as k,j as L,i as ge,A as K,L as J,M as Z,N as q,D as Te,o as Ee,T as ye,e as re,p as Ce}from"./scheduler.d70b54e9.js";import{S as Me,i as Re,g as Oe,c as Pe,a as v,t as N}from"./index.4ee4b432.js";import{e as ae,u as Le,o as De}from"./utils.4783f3e4.js";const b={AUTO:"auto",START:"start",CENTER:"center",END:"end"},C={HORIZONTAL:"horizontal",VERTICAL:"vertical"},w={OBSERVED:0,REQUESTED:1},we={[C.VERTICAL]:"top",[C.HORIZONTAL]:"left"},fe={[C.VERTICAL]:"scrollTop",[C.HORIZONTAL]:"scrollLeft"};class xe{constructor({itemSize:e,itemCount:t,estimatedItemSize:n}){this.itemSize=e,this.itemCount=t,this.estimatedItemSize=n,this.itemSizeAndPositionData={},this.lastMeasuredIndex=-1,this.checkForMismatchItemSizeAndItemCount(),this.justInTime||this.computeTotalSizeAndPositionData()}get justInTime(){return typeof this.itemSize=="function"}updateConfig({itemSize:e,itemCount:t,estimatedItemSize:n}){t!=null&&(this.itemCount=t),n!=null&&(this.estimatedItemSize=n),e!=null&&(this.itemSize=e),this.checkForMismatchItemSizeAndItemCount(),this.justInTime&&this.totalSize!=null?this.totalSize=void 0:this.computeTotalSizeAndPositionData()}checkForMismatchItemSizeAndItemCount(){if(Array.isArray(this.itemSize)&&this.itemSize.length<this.itemCount)throw Error("When itemSize is an array, itemSize.length can't be smaller than itemCount")}getSize(e){const{itemSize:t}=this;return typeof t=="function"?t(e):Array.isArray(t)?t[e]:t}computeTotalSizeAndPositionData(){let e=0;for(let t=0;t<this.itemCount;t++){const n=this.getSize(t),r=e;e+=n,this.itemSizeAndPositionData[t]={offset:r,size:n}}this.totalSize=e}getLastMeasuredIndex(){return this.lastMeasuredIndex}getSizeAndPositionForIndex(e){if(e<0||e>=this.itemCount)throw Error(`Requested index ${e} is outside of range 0..${this.itemCount}`);return this.justInTime?this.getJustInTimeSizeAndPositionForIndex(e):this.itemSizeAndPositionData[e]}getJustInTimeSizeAndPositionForIndex(e){if(e>this.lastMeasuredIndex){const t=this.getSizeAndPositionOfLastMeasuredItem();let n=t.offset+t.size;for(let r=this.lastMeasuredIndex+1;r<=e;r++){const o=this.getSize(r);if(o==null||isNaN(o))throw Error(`Invalid size returned for index ${r} of value ${o}`);this.itemSizeAndPositionData[r]={offset:n,size:o},n+=o}this.lastMeasuredIndex=e}return this.itemSizeAndPositionData[e]}getSizeAndPositionOfLastMeasuredItem(){return this.lastMeasuredIndex>=0?this.itemSizeAndPositionData[this.lastMeasuredIndex]:{offset:0,size:0}}getTotalSize(){if(this.totalSize)return this.totalSize;const e=this.getSizeAndPositionOfLastMeasuredItem();return e.offset+e.size+(this.itemCount-this.lastMeasuredIndex-1)*this.estimatedItemSize}getUpdatedOffsetForIndex({align:e=b.START,containerSize:t,currentOffset:n,targetIndex:r}){if(t<=0)return 0;const o=this.getSizeAndPositionForIndex(r),f=o.offset,h=f-t+o.size;let u;switch(e){case b.END:u=h;break;case b.CENTER:u=f-(t-o.size)/2;break;case b.START:u=f;break;default:u=Math.max(h,Math.min(f,n))}const d=this.getTotalSize();return Math.max(0,Math.min(d-t,u))}getVisibleRange({containerSize:e=0,offset:t,overscanCount:n}){if(this.getTotalSize()===0)return{};const o=t+e;let f=this.findNearestItem(t);if(f===void 0)throw Error(`Invalid offset ${t} specified`);const h=this.getSizeAndPositionForIndex(f);t=h.offset+h.size;let u=f;for(;t<o&&u<this.itemCount-1;)u++,t+=this.getSizeAndPositionForIndex(u).size;return n&&(f=Math.max(0,f-n),u=Math.min(u+n,this.itemCount-1)),{start:f,stop:u}}resetItem(e){this.lastMeasuredIndex=Math.min(this.lastMeasuredIndex,e-1)}findNearestItem(e){if(isNaN(e))throw Error(`Invalid offset ${e} specified`);e=Math.max(0,e);const t=this.getSizeAndPositionOfLastMeasuredItem(),n=Math.max(0,this.lastMeasuredIndex);return t.offset>=e?this.binarySearch({high:n,low:0,offset:e}):this.exponentialSearch({index:n,offset:e})}binarySearch({low:e,high:t,offset:n}){let r=0,o=0;for(;e<=t;){if(r=e+Math.floor((t-e)/2),o=this.getSizeAndPositionForIndex(r).offset,o===n)return r;o<n?e=r+1:o>n&&(t=r-1)}return e>0?e-1:0}exponentialSearch({index:e,offset:t}){let n=1;for(;e<this.itemCount&&this.getSizeAndPositionForIndex(e).offset<t;)e+=n,n*=2;return this.binarySearch({high:Math.min(e,this.itemCount-1),low:Math.floor(e/2),offset:t})}}const pe=a=>({}),he=a=>({});function ue(a,e,t){const n=a.slice();return n[37]=e[t],n}const be=a=>({style:a[0]&4,index:a[0]&4}),ce=a=>({style:a[37].style,index:a[37].index}),ke=a=>({}),de=a=>({});function me(a,e){let t,n;const r=e[21].item,o=G(r,e,e[20],ce);return{key:a,first:null,c(){t=re(),o&&o.c(),this.h()},l(f){t=re(),o&&o.l(f),this.h()},h(){this.first=t},m(f,h){ge(f,t,h),o&&o.m(f,h),n=!0},p(f,h){e=f,o&&o.p&&(!n||h[0]&1048580)&&J(o,r,e,e[20],n?q(r,e[20],h,be):Z(e[20]),ce)},i(f){n||(v(o,f),n=!0)},o(f){N(o,f),n=!1},d(f){f&&k(t),o&&o.d(f)}}}function ve(a){let e,t,n,r=[],o=new Map,f,h;const u=a[21].header,d=G(u,a,a[20],de);let S=ae(a[2]);const D=s=>s[0]?s[0](s[37].index):s[37].index;for(let s=0;s<S.length;s+=1){let l=ue(a,S,s),g=D(l);o.set(g,r[s]=me(g,l))}const I=a[21].footer,c=G(I,a,a[20],he);return{c(){e=ie("div"),d&&d.c(),t=se(),n=ie("div");for(let s=0;s<r.length;s+=1)r[s].c();f=se(),c&&c.c(),this.h()},l(s){e=ne(s,"DIV",{class:!0,style:!0});var l=oe(e);d&&d.l(l),t=le(l),n=ne(l,"DIV",{class:!0,style:!0});var g=oe(n);for(let M=0;M<r.length;M+=1)r[M].l(g);g.forEach(k),f=le(l),c&&c.l(l),l.forEach(k),this.h()},h(){L(n,"class","virtual-list-inner svelte-dwpad5"),L(n,"style",a[4]),L(e,"class","virtual-list-wrapper svelte-dwpad5"),L(e,"style",a[3])},m(s,l){ge(s,e,l),d&&d.m(e,null),K(e,t),K(e,n);for(let g=0;g<r.length;g+=1)r[g]&&r[g].m(n,null);K(e,f),c&&c.m(e,null),a[22](e),h=!0},p(s,l){d&&d.p&&(!h||l[0]&1048576)&&J(d,u,s,s[20],h?q(u,s[20],l,ke):Z(s[20]),de),l[0]&1048581&&(S=ae(s[2]),Oe(),r=Le(r,l,D,1,s,S,o,n,De,me,null,ue),Pe()),(!h||l[0]&16)&&L(n,"style",s[4]),c&&c.p&&(!h||l[0]&1048576)&&J(c,I,s,s[20],h?q(I,s[20],l,pe):Z(s[20]),he),(!h||l[0]&8)&&L(e,"style",s[3])},i(s){if(!h){v(d,s);for(let l=0;l<S.length;l+=1)v(r[l]);v(c,s),h=!0}},o(s){N(d,s);for(let l=0;l<r.length;l+=1)N(r[l]);N(c,s),h=!1},d(s){s&&k(e),d&&d.d(s);for(let l=0;l<r.length;l+=1)r[l].d();c&&c.d(s),a[22](null)}}}const Ne=(()=>{let a=!1;try{const e=Object.defineProperty({},"passive",{get(){return a={passive:!0},!0}});window.addEventListener("testpassive",e,e),window.remove("testpassive",e,e)}catch{}return a})();function Ve(a,e,t){let{$$slots:n={},$$scope:r}=e,{height:o}=e,{width:f="100%"}=e,{itemCount:h}=e,{itemSize:u}=e,{estimatedItemSize:d=null}=e,{stickyIndices:S=null}=e,{getKey:D=null}=e,{scrollDirection:I=C.VERTICAL}=e,{scrollOffset:c=null}=e,{scrollToIndex:s=null}=e,{scrollToAlignment:l=null}=e,{scrollToBehaviour:g="instant"}=e,{overscanCount:M=3}=e;const W=Te(),O=new xe({itemCount:h,itemSize:u,estimatedItemSize:X()});let P=!1,z,V=[],_={offset:c||s!=null&&V.length&&Q(s)||0,scrollChangeReason:w.REQUESTED},x=_,R={scrollToIndex:s,scrollToAlignment:l,scrollOffset:c,itemCount:h,itemSize:u,estimatedItemSize:d},p={},F="",U="";j(),Ee(()=>{t(18,P=!0),z.addEventListener("scroll",Y,Ne),c!=null?B(c):s!=null&&B(Q(s))}),ye(()=>{P&&z.removeEventListener("scroll",Y)});function Se(){if(!P)return;const i=R.scrollToIndex!==s||R.scrollToAlignment!==l,m=R.itemCount!==h||R.itemSize!==u||R.estimatedItemSize!==d;m&&(O.updateConfig({itemSize:u,itemCount:h,estimatedItemSize:X()}),H()),R.scrollOffset!==c?t(19,_={offset:c||0,scrollChangeReason:w.REQUESTED}):typeof s=="number"&&(i||m)&&t(19,_={offset:Q(s,l,h),scrollChangeReason:w.REQUESTED}),R={scrollToIndex:s,scrollToAlignment:l,scrollOffset:c,itemCount:h,itemSize:u,estimatedItemSize:d}}function Ie(){if(!P)return;const{offset:i,scrollChangeReason:m}=_;(x.offset!==i||x.scrollChangeReason!==m)&&j(),x.offset!==i&&m===w.REQUESTED&&B(i),x=_}function j(){const{offset:i}=_,{start:m,stop:A}=O.getVisibleRange({containerSize:I===C.VERTICAL?o:f,offset:i,overscanCount:M});let T=[];const E=O.getTotalSize();I===C.VERTICAL?(t(3,F=`height:${o}px;width:${f};`),t(4,U=`flex-direction:column;height:${E}px;`)):(t(3,F=`height:${o};width:${f}px`),t(4,U=`min-height:100%;width:${E}px;`));const ee=S!=null&&S.length!==0;if(ee)for(let y=0;y<S.length;y++){const te=S[y];T.push({index:te,style:$(te,!0)})}if(m!==void 0&&A!==void 0){for(let y=m;y<=A;y++)ee&&S.includes(y)||T.push({index:y,style:$(y,!1)});W("itemsUpdated",{start:m,end:A})}t(2,V=T)}function B(i){"scroll"in z?z.scroll({[we[I]]:i,behavior:g}):t(1,z[fe[I]]=i,z)}function H(i=0){p={},O.resetItem(i),j()}function Q(i,m=l,A=h){return(i<0||i>=A)&&(i=0),O.getUpdatedOffsetForIndex({align:m,containerSize:I===C.VERTICAL?o:f,currentOffset:_.offset||0,targetIndex:i})}function Y(i){const m=ze();m<0||_.offset===m||i.target!==z||(t(19,_={offset:m,scrollChangeReason:w.OBSERVED}),W("afterScroll",{offset:m,event:i}))}function ze(){return z[fe[I]]}function X(){return d||typeof u=="number"&&u||50}function $(i,m){if(p[i])return p[i];const{size:A,offset:T}=O.getSizeAndPositionForIndex(i);let E;return I===C.VERTICAL?(E=`left:0;width:100%;height:${A}px;`,m?E+=`position:sticky;flex-grow:0;z-index:1;top:0;margin-top:${T}px;margin-bottom:${-(T+A)}px;`:E+=`position:absolute;top:${T}px;`):(E=`top:0;width:${A}px;`,m?E+=`position:sticky;z-index:1;left:0;margin-left:${T}px;margin-right:${-(T+A)}px;`:E+=`position:absolute;height:100%;left:${T}px;`),p[i]=E}function _e(i){Ce[i?"unshift":"push"](()=>{z=i,t(1,z)})}return a.$$set=i=>{"height"in i&&t(5,o=i.height),"width"in i&&t(6,f=i.width),"itemCount"in i&&t(7,h=i.itemCount),"itemSize"in i&&t(8,u=i.itemSize),"estimatedItemSize"in i&&t(9,d=i.estimatedItemSize),"stickyIndices"in i&&t(10,S=i.stickyIndices),"getKey"in i&&t(0,D=i.getKey),"scrollDirection"in i&&t(11,I=i.scrollDirection),"scrollOffset"in i&&t(12,c=i.scrollOffset),"scrollToIndex"in i&&t(13,s=i.scrollToIndex),"scrollToAlignment"in i&&t(14,l=i.scrollToAlignment),"scrollToBehaviour"in i&&t(15,g=i.scrollToBehaviour),"overscanCount"in i&&t(16,M=i.overscanCount),"$$scope"in i&&t(20,r=i.$$scope)},a.$$.update=()=>{a.$$.dirty[0]&29568&&Se(),a.$$.dirty[0]&524288&&Ie(),a.$$.dirty[0]&263264&&P&&H(0)},[D,z,V,F,U,o,f,h,u,d,S,I,c,s,l,g,M,H,P,_,r,n,_e]}class Be extends Me{constructor(e){super(),Re(this,e,Ve,ve,Ae,{height:5,width:6,itemCount:7,itemSize:8,estimatedItemSize:9,stickyIndices:10,getKey:0,scrollDirection:11,scrollOffset:12,scrollToIndex:13,scrollToAlignment:14,scrollToBehaviour:15,overscanCount:16,recomputeSizes:17},null,[-1,-1])}get recomputeSizes(){return this.$$.ctx[17]}}export{Be as V};
